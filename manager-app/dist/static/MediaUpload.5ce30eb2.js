import{b as e,_ as a,p as s}from"./index.547c0c45.js";import{q as t,o as n,t as o,v as r,f as l,b as i,a as c,w as d,u,L as m,aw as p,ax as f}from"./vue.89ed3d48.js";import{i as v}from"./login.ed01525e.js";import{e as x}from"./index.3b31d7d7.js";import{_ as y}from"./request.356cbcf4.js";const g=t({name:"Download"}),h={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},b=[r("path",{fill:"currentColor",d:"M160 832h704a32 32 0 1 1 0 64H160a32 32 0 1 1 0-64zm384-253.696 236.288-236.352 45.248 45.248L508.8 704 192 387.2l45.248-45.248L480 584.704V128h64v450.304z"},null,-1)];var w=e(g,[["render",function(e,a,s,t,r,l){return n(),o("svg",h,b)}]]);const _={class:"fc fcc"},j=(e=>(p("data-v-d1e2ccde"),e=e(),f(),e))((()=>r("div",{class:"file_name"},"点击上传",-1))),S=["innerHTML"];var L=a(t({props:{exnameList:{default:()=>[".jpg",".png",".jpeg",".JPG",".PNG",".JPEG"]},max:{default:1},msg:null,maxSize:{default:2}},emits:["upOneSuccess","error","look","change","del"],setup(e,{expose:a,emit:t}){const p=e,f=l([]),g=l(),h=(e,a)=>{if(!e.name)return;const s=e.name.substring(e.name.lastIndexOf("."));if(-1==p.exnameList.indexOf(s))return g.value.handleRemove(e),void x("图片格式错误！");if(e.size&&e.size/1024/1024>p.maxSize)return g.value.handleRemove(e),void x(`图片文件大小不能超过${p.maxSize}M`);f.value=a;const n=document.querySelector(".el-upload--picture-card");f.value.length>=p.max&&(n.style.display="none");const o=e.name.substring(0,e.name.indexOf("."));t("change",o)},b=(e,a)=>{t("del"),f.value=a,document.querySelector(".el-upload--picture-card").style.display="inline-flex"},w=e=>{let a=[];f.value.forEach((e=>{a.push(e.url)})),t("look",a,a.findIndex((a=>a==e.url)))},L=async e=>{const a=await v({site:"official_img"});if(1==a.status){const s=e.name.substring(e.name.lastIndexOf(".")),n=new FormData,o={key:a.body.dir+"/"+a.body.uuid+s,OSSAccessKeyId:a.body.accessid,success_action_status:200,policy:a.body.policy,signature:a.body.signature};for(const[e,a]of Object.entries(o))n.append(e,a);n.append("file",e.raw);if(200==(await y({url:a.body.host,method:"post",headers:{"Content-Type":"multipart/form-data;"},data:n})).status){const e=a.body.host+"/"+a.body.dir+"/"+a.body.uuid+s;return t("upOneSuccess",e,f.value.length),Promise.resolve(e)}return Promise.reject(e.name+"上传失败")}return Promise.reject("获取上传配置失败")},O=e=>{p.max>1||(g.value.clearFiles(),g.value.handleStart(e[0]))};return a({submit:async()=>{try{for(let e=0;e<f.value.length;e++){const a=f.value[e];await L(a).catch((e=>{throw new Error(e)}))}}catch(e){t("error",e)}},clear:()=>{},imgs:f}),(a,t)=>{const l=i("el-icon"),p=i("el-upload");return n(),o("div",{class:m(["media_upload flex",1==e.max?"one_up":""])},[c(p,{action:"#","auto-upload":!1,limit:e.max,multiple:e.max>1,"list-type":"picture-card","on-exceed":O,"on-change":h,"on-preview":w,"on-remove":b,accept:e.exnameList.join(","),ref_key:"upload",ref:g,class:"upbox"},{default:d((()=>[r("div",_,[c(l,null,{default:d((()=>[c(u(s))])),_:1}),j])])),_:1},8,["limit","multiple","accept"]),r("div",{class:"tips",innerHTML:e.msg},null,8,S)],2)}}}),[["__scopeId","data-v-d1e2ccde"]]);export{L as M,w as d};

import{i as e}from"./login.76a81bb1.js";import{e as a}from"./index.a86c6ab1.js";import{_ as s}from"./request.b31062f2.js";import{_ as t,p as i}from"./index.12522c67.js";import{G as n,B as o,q as l,g as r,b as u,o as c,H as d,a as m,w as p,I as f,C as y,W as x,aw as v,ax as g}from"./vue.73bee448.js";const b={class:"fc fcc"},h=(e=>(v("data-v-59748b1f"),e=e(),g(),e))((()=>f("div",{class:"file_name"},"点击上传",-1))),_=["innerHTML"];var j=t(n({props:{exnameList:{default:()=>[".jpg",".png",".jpeg",".JPG",".PNG",".JPEG"]},max:{default:1},msg:null,maxSize:{default:2},imgList:{default:()=>[]}},emits:["upOneSuccess","error","look","change","del"],setup(t,{expose:n,emit:v}){const g=t;o((()=>{l((()=>{if(g.imgList.length&&1==g.max){document.querySelector(".el-upload--picture-card").style.display="none"}}))}));const j=r([]),S=r(),w=(e,s)=>{if(!e.name)return;const t=e.name.substring(e.name.lastIndexOf("."));if(-1==g.exnameList.indexOf(t))return S.value.handleRemove(e),void a("图片格式错误！");if(e.size&&e.size/1024/1024>g.maxSize)return S.value.handleRemove(e),void a(`图片文件大小不能超过${g.maxSize}M`);j.value=s;const i=document.querySelector(".el-upload--picture-card");j.value.length>=g.max&&(i.style.display="none");const n=e.name.substring(0,e.name.indexOf("."));v("change",n)},L=(e,a)=>{v("del"),j.value=a,document.querySelector(".el-upload--picture-card").style.display="inline-flex"},O=e=>{let a=[];j.value.forEach((e=>{a.push(e.url)})),v("look",a,a.findIndex((a=>a==e.url)))},I=async a=>{const t=await e({site:"official_img"});if(1==t.status){const e=a.name.substring(a.name.lastIndexOf(".")),i=new FormData,n={key:t.body.dir+"/"+t.body.uuid+e,OSSAccessKeyId:t.body.accessid,success_action_status:200,policy:t.body.policy,signature:t.body.signature};for(const[a,s]of Object.entries(n))i.append(a,s);i.append("file",a.raw);if(200==(await s({url:t.body.host,method:"post",headers:{"Content-Type":"multipart/form-data;"},data:i})).status){const a=t.body.host+"/"+t.body.dir+"/"+t.body.uuid+e;return v("upOneSuccess",a,j.value.length),Promise.resolve(a)}return Promise.reject(a.name+"上传失败")}return Promise.reject("获取上传配置失败")},P=e=>{g.max>1||(S.value.clearFiles(),S.value.handleStart(e[0]))};return n({submit:async()=>{try{for(let e=0;e<j.value.length;e++){const a=j.value[e];await I(a).catch((e=>{throw new Error(e)}))}}catch(e){v("error",e)}},clear:()=>{},imgs:j}),(e,a)=>{const s=u("el-icon"),n=u("el-upload");return c(),d("div",{class:x(["media_upload flex",1==t.max?"one_up":""])},[m(n,{action:"#","auto-upload":!1,limit:t.max,multiple:t.max>1,"list-type":"picture-card","on-exceed":P,"on-change":w,"on-preview":O,"on-remove":L,accept:t.exnameList.join(","),ref_key:"upload",ref:S,class:"upbox","file-list":t.imgList.map((e=>({name:"",url:e})))},{default:p((()=>[f("div",b,[m(s,null,{default:p((()=>[m(y(i))])),_:1}),h])])),_:1},8,["limit","multiple","accept","file-list"]),f("div",{class:"tips",innerHTML:t.msg},null,8,_)],2)}}}),[["__scopeId","data-v-59748b1f"]]);export{j as M};

var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,r=(e,a)=>{for(var l in a||(a={}))s.call(a,l)&&i(e,l,a[l]);if(t)for(var l of t(a))o.call(a,l)&&i(e,l,a[l]);return e},u=(e,t)=>a(e,l(t));import{s as d}from"./Search.7c0090ac.js";import{M as n}from"./MyPage.4b5aaeff.js";import{M as c}from"./MyDataTable.ab103cf9.js";import{M as p}from"./MyDialog.f51fc1f9.js";import{M as m}from"./MyEmpty.07f2695e.js";import{_ as v}from"./request.71e82bfd.js";import{R as f}from"./Refuse.d66d5413.js";import{e as y,o as b}from"./index.c36e50f5.js";import{i as h}from"./login.a80e1ce3.js";import{a as _,b as w,d as g,e as j,i as x}from"./custom.b2fe2c3a.js";import{_ as k,p as C}from"./index.4a788974.js";import{G as P,g as V,j as O,o as I,H as M,a as S,w as G,C as U,k as E,_ as z,c as D,P as J,aa as N,I as R,a0 as T,a1 as q,aw as F,ax as A,b as H,ae as K}from"./vue.73bee448.js";import"./date.23847c74.js";import"./index.f61f506c.js";import"./findb.dc218805.js";import"./empty.f131d8fb.js";const B=e=>(F("data-v-1c8cf9d8"),e=e(),A(),e),L={class:"mytable"},Q={class:"fcs"},W=q("编辑"),X=q("驳回原因"),Y=q("详情"),Z={key:3},$=q("下载附件"),ee=q("通过"),ae=q("驳回"),le={key:0,class:"img-dialog"},te=B((()=>R("div",{class:"image-slot"},[
R("h3",null,"暂无数据")],-1))),se={class:"dialog-footer"},oe=q("确认"),ie={class:"fc fcc"},re=B((()=>R("div",{class:"file_name"},"点击上传",-1))),ue=B((()=>R("div",{class:"uptext"}," 图片尺寸16:9，建议尺寸：220*160≤尺寸≤1920*890；支持JPG、PNG 、JPEG等格式；一次最多上传9张 ",-1))),de={class:"fcs btns fjend"},ne=q("取消"),ce=q("提交");var pe=k(P(u(r({},{name:"CustomImages"}),{setup(e){const a=V([{type:"text",lable:"需求ID",prop:"id",width:120},{type:"text",lable:"账户名",prop:"user_name",width:120},{type:"text",lable:"客户名称",prop:"company_name",width:180},{type:"text",lable:"标题",prop:"title",width:150},{type:"text-tooltip",lable:"描述",prop:"detail",width:120},{type:"date",lable:"创建日期",prop:"create_time",width:110},{type:"status",lable:"状态",prop:"status",width:100}]),l=O({}),t=V(!1),s=V(10),o=V(0),i=V(1),k=V([]),P=V(!1),q=V(""),F=O({userName:"",status:"",create_time:""}),A=()=>{F.userName="",F.status="",F.create_time="",Se()},B=e=>{i.value=1,Se()},pe=V(!1),me=V(),ve=async e=>{const a={id:me.value,fail_reason:e,status:4},{status:l,body:t}=await w(a);l&&(pe.value=!1,Se())},fe=V(!1),ye=V([]),be=V(!1),he=V([]),_e=V(),we=V(!1),ge=V(0);let je=[];const xe=V(""),ke=[".jpg",".png",".jpeg",".JPG",".PNG",".JPEG"],Ce=(e,a)=>{if(!e.name)return;const l=e.name.substring(e.name.lastIndexOf("."));if(-1==ke.indexOf(l))return _e.value.handleRemove(e),void y("图片格式错误！");he.value=a,he.value.length>=9&&(document.querySelector(".el-upload--picture-card").style.display="none")},Pe=(e,a)=>{he.value=a,document.querySelector(".el-upload--picture-card").style.display="inline-flex"},Ve=e=>{const a=[];he.value.forEach((e=>{a.push(e.url)})),ye.value=a,ge.value=ye.value.findIndex((a=>a==e.url)),we.value=!0},Oe=()=>{_e.value.clearFiles(),be.value=!1,t.value=!1,he.value=[],ye.value=[],we.value=!1,ge.value=0,je=[]},Ie=async(e,a,l)=>{const t=await h({site:"official_img"});if(1==t.status){const a=e.name.substring(e.name.lastIndexOf(".")),l=new FormData,s={key:t.body.dir+"/"+t.body.uuid+a,OSSAccessKeyId:t.body.accessid,success_action_status:200,policy:t.body.policy,signature:t.body.signature};for(const[e,t]of Object.entries(s))l.append(e,t);l.append("file",e.raw);if(200==(await v({url:t.body.host,method:"post",headers:{"Content-Type":"multipart/form-data;"},data:l})).status){const e=t.body.host+"/"+t.body.dir+"/"+t.body.uuid+a;return je.push(e),Promise.resolve(e)}return Promise.reject(e.name+"上传失败")}return Promise.reject("获取上传配置失败")},Me=async(e,a)=>{t.value=!0;try{for(let e=0;e<he.value.length;e++){const a=he.value[e];await Ie(a).catch((e=>{throw new Error(e)})).then((()=>{je.length==he.value.length&&j({urls:je,order_id:xe.value}).then((e=>{b("上传成功"),Oe(),Se()}))}))}}catch(l){y(l,0),Oe(),Se()}},Se=async()=>{t.value=!0;const e=await x(u(r({size:s.value,current:i.value},F),{startTime:F.create_time?F.create_time[0]:null,endTime:F.create_time?F.create_time[1]:null}));t.value=!1,1==e.status&&(o.value=e.body.total,k.value=e.body.records)};return Se(),(e,r)=>{const u=H("el-option"),v=H("el-link"),y=H("el-table-column"),b=H("el-table"),h=H("el-card"),w=H("el-image"),j=H("el-button"),x=H("el-dialog"),V=H("el-icon"),O=H("el-upload"),je=H("el-form-item"),Ie=H("el-form"),Ge=H("el-image-viewer"),Ue=K("loading");return I(),M("div",L,[S(d,{modelValue:U(F),"onUpdate:modelValue":r[0]||(r[0]=e=>E(F)?F.value=e:F=e),onSearch:B,onReset:A},{default:G((()=>[S(u,{label:"全部",value:"null"}),S(u,{label:"待处理",value:"1"}),S(u,{label:"已受理",value:"2"}),S(u,{label:"被驳回",value:"3"}),S(u,{label:"已完成",value:"4"})])),_:1},8,["modelValue"]),S(h,{class:"mycard mt20"},{default:G((()=>[z((I(),D(b,{data:k.value,border:"",style:{width:"100%"},"row-class-name":"my-data-table-row"},{empty:G((()=>[S(m)])),default:G((()=>[(I(!0),M(J,null,N(a.value,((e,a)=>(I(),D(c,{key:a,type:e.type,width:e.width,lable:e.lable,prop:e.prop},null,8,["type","width","lable","prop"])))),128)),S(y,{width:"150",label:"操作"},{default:G((({row:e})=>[R("div",Q,[2==e.status?(I(),D(v,{key:0,type:"primary",onClick:a=>{return l=e.id,e.attach_url,xe.value=l,void(be.value=!0);var l}},{default:G((()=>[W])),_:2},1032,["onClick"])):T("",!0),3==e.status?(I(),D(v,{key:1,type:"primary",onClick:a=>{q.value=e.fail_reason,P.value=!0}},{default:G((()=>[X])),_:2},1032,["onClick"])):T("",!0),4==e.status?(I(),D(v,{key:2,type:"primary",onClick:a=>(async e=>{const a=await g({id:e});1==a.status&&(ye.value=a.body.list),fe.value=!0})(e.id)},{default:G((()=>[Y])),_:2},1032,["onClick"])):T("",!0),1==e.status?(I(),M("div",Z,[e.attach_url?(I(),D(v,{key:0,type:"primary",class:"fcss",href:e.attach_url,"down-load":"附件.zip"},{default:G((()=>[$])),_:2},1032,["href"])):T("",!0),S(v,{type:"primary",class:"fcss",onClick:a=>(async e=>{const{status:a}=await _({id:e});a&&Se()})(e.id)},{default:G((()=>[ee])),_:2},1032,["onClick"]),S(v,{type:"primary",onClick:a=>{return l=e.id,pe.value=!0,void(me.value=l);var l}},{default:G((()=>[ae])),_:2},1032,["onClick"])])):T("",!0)])])),_:1})])),_:1},8,["data"])),[[Ue,t.value]]),S(n,{page:i.value,"onUpdate:page":r[1]||(r[1]=e=>i.value=e),size:s.value,"onUpdate:size":r[2]||(r[2]=e=>s.value=e),total:o.value,onChange:Se},null,8,["page","size","total"])])),_:1}),S(x,{modelValue:fe.value,"onUpdate:modelValue":r[4]||(r[4]=e=>fe.value=e),title:"详情图片",width:"510px"},{footer:G((()=>[R("span",se,[S(j,{type:"primary",onClick:r[3]||(r[3]=e=>fe.value=!1)},{default:G((()=>[oe])),_:1})])])),default:G((()=>[ye.value?(I(),M("div",le,[(I(!0),M(J,null,N(ye.value,((e,a)=>(I(),D(w,{key:e,style:{width:"120px",height:"135px","margin-top":"10px"},fit:"",src:e,"preview-src-list":ye.value,"initial-index":a},{error:G((()=>[te])),_:2},1032,["src","preview-src-list","initial-index"])))),128))])):T("",!0)])),_:1},8,["modelValue"]),S(x,{modelValue:be.value,"onUpdate:modelValue":r[5]||(r[5]=e=>be.value=e),title:"编辑图片",width:"510px","custom-class":"upimgs",onClose:Oe},{default:G((()=>[S(Ie,{model:U(l)},{default:G((()=>[S(je,{label:"图片上传","label-width":"90px"},{default:G((()=>[S(O,{ref_key:"upload",ref:_e,action:"#","auto-upload":!1,limit:9,multiple:!0,"list-type":"picture-card","on-change":Ce,"on-preview":Ve,"on-remove":Pe,accept:ke.join(","),class:"upbox"},{default:G((()=>[R("div",ie,[S(V,null,{default:G((()=>[S(U(C))])),_:1}),re])])),_:1},8,["accept"])])),_:1})])),_:1},8,["model"]),ue,R("div",de,[S(j,{onClick:Oe},{default:G((()=>[ne])),_:1}),S(j,{type:"primary",disabled:!he.value.length,onClick:Me},{default:G((()=>[ce])),_:1},8,["disabled"])])])),_:1},8,["modelValue"]),we.value?(I(),D(Ge,{key:0,"url-list":ye.value,"initial-index":ge.value,onClose:r[6]||(r[6]=e=>we.value=!1)},null,8,["url-list","initial-index"])):T("",!0),S(p,{modelValue:P.value,"onUpdate:modelValue":r[7]||(r[7]=e=>P.value=e),msg:q.value,title:"驳回原因",btn:1},null,8,["modelValue","msg"]),S(f,{modelValue:pe.value,"onUpdate:modelValue":r[8]||(r[8]=e=>pe.value=e),onSuccess:ve},null,8,["modelValue"])])}}})),[["__scopeId","data-v-1c8cf9d8"]]);export{pe as default};

import{i as e}from"./login.df5d82cd.js";import{e as a}from"./index.3ae96932.js";import{_ as t}from"./request.7878c8f3.js";import{_ as s,p as n}from"./index.e7872df1.js";import{G as o,B as i,q as l,g as r,b as d,o as c,H as u,a as m,w as p,I as f,C as y,W as x,aw as v,ax as g}from"./vue.73bee448.js";const h={class:"fc fcc"},b=(e=>(v("data-v-7a8db3c6"),e=e(),g(),e))((()=>f("div",{class:"file_name"},"拖拽/点击上传",-1))),_=["innerHTML"];var w=s(o({props:{exnameList:{default:()=>[".jpg",".png",".jpeg",".JPG",".PNG",".JPEG"]},max:{default:1},msg:null,maxSize:{default:2},imgList:{default:()=>[]},needDownload:{type:Boolean,default:!1}},emits:["upOneSuccess","error","look","change","del"],setup(s,{expose:o,emit:v}){const g=s;i((()=>{l((()=>{if(g.imgList.length&&1==g.max){document.querySelector(".el-upload--picture-card").style.display="none"}}))}));const w=r([]),j=r(),S=(e,t)=>{if(!e.name)return;const s=e.name.substring(e.name.lastIndexOf("."));if(-1==g.exnameList.indexOf(s))return j.value.handleRemove(e),void a("图片格式错误！");if(e.size&&e.size/1024/1024>g.maxSize)return j.value.handleRemove(e),void a(`图片文件大小不能超过${g.maxSize}M`);w.value=t;const n=document.querySelector(".el-upload--picture-card");w.value.length>=g.max&&(n.style.display="none");const o=e.name.substring(0,e.name.indexOf("."));v("change",o)},L=(e,a)=>{v("del"),w.value=a,document.querySelector(".el-upload--picture-card").style.display="inline-flex"},O=e=>{let a=[];w.value.forEach((e=>{a.push(e.url)})),v("look",a,a.findIndex((a=>a==e.url)))},I=async(a,s)=>{const n=await e({site:"official_img"});if(1==n.status){const e=a.name.substring(a.name.lastIndexOf(".")),o=new FormData,i={key:n.body.dir+"/"+n.body.uuid+e,OSSAccessKeyId:n.body.accessid,success_action_status:"200",policy:n.body.policy,signature:n.body.signature};if(g.needDownload){const t=s?s+e:a.name;i["Content-Disposition"]="attachment; filename="+encodeURIComponent(t)}for(const[a,t]of Object.entries(i))o.append(a,t);o.append("file",a.raw);if(200==(await t({url:n.body.host,method:"post",headers:{"Content-Type":"multipart/form-data;"},data:o})).status){const a=n.body.host+"/"+n.body.dir+"/"+n.body.uuid+e;return v("upOneSuccess",a,w.value.length),Promise.resolve(a)}return Promise.reject(a.name+"上传失败")}return Promise.reject("获取上传配置失败")},P=e=>{g.max>1||(j.value.clearFiles(),j.value.handleStart(e[0]))};return o({submit:async e=>{try{for(let a=0;a<w.value.length;a++){const t=w.value[a];await I(t,e).catch((e=>{throw new Error(e)}))}}catch(a){v("error",a)}},clear:()=>{},imgs:w}),(e,a)=>{const t=d("el-icon"),o=d("el-upload");return c(),u("div",{class:x(["media_upload flex",1==s.max?"one_up":""])},[m(o,{drag:"",action:"#","auto-upload":!1,limit:s.max,multiple:s.max>1,"list-type":"picture-card","on-exceed":P,"on-change":S,"on-preview":O,"on-remove":L,accept:s.exnameList.join(","),ref_key:"upload",ref:j,class:"upbox","file-list":s.imgList.map((e=>({name:"",url:e})))},{default:p((()=>[f("div",h,[m(t,null,{default:p((()=>[m(y(n))])),_:1}),b])])),_:1},8,["limit","multiple","accept","file-list"]),f("div",{class:"tips",innerHTML:s.msg},null,8,_)],2)}}}),[["__scopeId","data-v-7a8db3c6"]]);export{w as M};

var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,r=(e,a)=>{for(var l in a||(a={}))s.call(a,l)&&i(e,l,a[l]);if(t)for(var l of t(a))o.call(a,l)&&i(e,l,a[l]);return e},u=(e,t)=>a(e,l(t));import{s as d}from"./Search.490f2d0f.js";import{M as n}from"./MyPage.0cd03366.js";import{M as c}from"./MyDataTable.870ec3a0.js";import{M as p}from"./MyDialog.32fde60c.js";import{M as m}from"./MyEmpty.d21dbe7c.js";import{R as v}from"./Refuse.e8d51cc6.js";import{_ as y}from"./request.b31062f2.js";import{e as f,o as b}from"./index.a86c6ab1.js";import{i as h}from"./login.76a81bb1.js";import{a as w,b as _,c as g,e as j,g as k,p as x}from"./custom.361f566a.js";import{_ as C,p as P}from"./index.12522c67.js";import{G as V,g as O,j as I,o as M,H as S,a as G,w as U,C as D,k as E,_ as z,c as J,P as N,aa as R,I as T,a0 as q,a1 as F,aw as A,ax as H,b as K,ae as B}from"./vue.73bee448.js";import"./date.23847c74.js";import"./index.5d447f79.js";import"./findb.c21ee009.js";import"./empty.f131d8fb.js";const L=e=>(A("data-v-8a8d9694"),e=e(),H(),e),Q={class:"mytable"},W={class:"fcs"},X=F("编辑"),Y=F("驳回原因"),Z=F("详情"),$={key:3},ee=F("下载附件"),ae=F("通过"),le=F("驳回"),te={key:0,class:"img-dialog"},se=L((()=>T("div",{class:"image-slot"},[
T("h3",null,"暂无数据")],-1))),oe={class:"dialog-footer"},ie=F("确认"),re={class:"fc fcc"},ue=L((()=>T("div",{class:"file_name"},"点击上传",-1))),de=L((()=>T("div",{class:"uptext"}," 图片尺寸16:9，建议尺寸：220*160≤尺寸≤1920*890；支持JPG、PNG 、JPEG等格式；一次最多上传9张 ",-1))),ne={class:"fcs btns fjend"},ce=F("取消"),pe=F("提交");var me=C(V(u(r({},{name:"CustomPoster"}),{setup(e,{expose:a}){const l=O([{type:"text",lable:"需求ID",prop:"id",width:120},{type:"text",lable:"账户名",prop:"user_name",width:120},{type:"text",lable:"客户名称",prop:"company_name",width:180},{type:"text",lable:"标题",prop:"title",width:150},{type:"text-tooltip",lable:"描述",prop:"detail",width:120},{type:"date",lable:"创建日期",prop:"create_time",width:110},{type:"status",lable:"状态",prop:"status",width:100}]),t=I({}),s=O(!1),o=O(10),i=O(0),C=O(1),V=O([]),F=O(!1),A=O(""),H=I({userName:"",status:"",create_time:""}),L=()=>{H.userName="",H.status="",H.create_time="",De()},me=e=>{C.value=1,De()},ve=O(!1),ye=O(),fe=async e=>{const a={id:ye.value,fail_reason:e,status:4},{status:l,body:t}=await _(a);l&&(ve.value=!1,De())},be=async e=>{const a=await g({id:e});1==a.status&&(window.location.href=a.body.attach_url)},he=O(!1),we=O([]),_e=O(!1),ge=O([]),je=O(),ke=O(!1),xe=O(0);let Ce=[];const Pe=O(""),Ve=[".jpg",".png",".jpeg",".JPG",".PNG",".JPEG"],Oe=(e,a)=>{const l=e.name.substring(e.name.lastIndexOf("."));if(-1==Ve.indexOf(l))return je.value.handleRemove(e),void f("图片格式错误！");ge.value=a,ge.value.length>=9&&(document.querySelector(".el-upload--picture-card").style.display="none")},Ie=(e,a)=>{ge.value=a,document.querySelector(".el-upload--picture-card").style.display="inline-flex"},Me=e=>{const a=[];ge.value.forEach((e=>{a.push(e.url)})),we.value=a,xe.value=we.value.findIndex((a=>a==e.url)),ke.value=!0},Se=()=>{je.value.clearFiles(),_e.value=!1,s.value=!1,ge.value=[],we.value=[],ke.value=!1,xe.value=0,Ce=[]},Ge=async(e,a,l)=>{const t=await h({site:"official_img"});if(1==t.status){const a=e.name.substring(e.name.lastIndexOf(".")),l=new FormData,s={key:t.body.dir+"/"+t.body.uuid+a,OSSAccessKeyId:t.body.accessid,success_action_status:200,policy:t.body.policy,signature:t.body.signature};for(const[e,t]of Object.entries(s))l.append(e,t);l.append("file",e.raw);if(200==(await y({url:t.body.host,method:"post",headers:{"Content-Type":"multipart/form-data;"},data:l})).status){const e=t.body.host+"/"+t.body.dir+"/"+t.body.uuid+a;return Ce.push(e),Promise.resolve(e)}return Promise.reject(e.name+"上传失败")}return Promise.reject("获取上传配置失败")},Ue=async(e,a)=>{s.value=!0;try{for(let e=0;e<ge.value.length;e++){const a=ge.value[e];await Ge(a).catch((e=>{throw new Error(e)})).then((()=>{Ce.length==ge.value.length&&k({urls:Ce,order_id:Pe.value}).then((e=>{}))}));if(Ce.length==ge.value.length){b("上传成功"),Se(),De();break}}De()}catch(l){f(l,0),Se(),De()}};a({getData:be});const De=async()=>{s.value=!0;const e=await x(u(r({size:o.value,current:C.value},H),{startTime:H.create_time[0],endTime:H.create_time[1]}));s.value=!1,1==e.status&&(i.value=e.body.total,V.value=e.body.records)};return De(),(e,a)=>{const r=K("el-option"),u=K("el-link"),y=K("el-table-column"),f=K("el-table"),b=K("el-card"),h=K("el-image"),_=K("el-button"),g=K("el-dialog"),k=K("el-icon"),x=K("el-upload"),O=K("el-form-item"),I=K("el-form"),Ce=K("el-image-viewer"),Ge=B("loading");return M(),S("div",Q,[G(d,{modelValue:D(H),"onUpdate:modelValue":a[0]||(a[0]=e=>E(H)?H.value=e:H=e),onSearch:me,onReset:L},{default:U((()=>[G(r,{label:"待处理",value:"1"}),G(r,{label:"已受理",value:"2"}),G(r,{label:"被驳回",value:"3"}),G(r,{label:"已完成",value:"4"})])),_:1},8,["modelValue"]),G(b,{class:"mycard mt20"},{default:U((()=>[z((M(),J(f,{data:V.value,border:"",style:{width:"100%"},"row-class-name":"my-data-table-row"},{empty:U((()=>[G(m)])),default:U((()=>[(M(!0),S(N,null,R(l.value,((e,a)=>(M(),J(c,{key:a,type:e.type,width:e.width,lable:e.lable,prop:e.prop},null,8,["type","width","lable","prop"])))),128)),G(y,{width:"150",label:"操作"},{default:U((({row:e})=>[T("div",W,[2==e.status?(M(),J(u,{key:0,type:"primary",onClick:a=>{return l=e.id,e.attach_url,_e.value=!0,void(Pe.value=l);var l}},{default:U((()=>[X])),_:2},1032,["onClick"])):q("",!0),3==e.status?(M(),J(u,{key:1,type:"primary",onClick:a=>{A.value=e.fail_reason,F.value=!0}},{default:U((()=>[Y])),_:2},1032,["onClick"])):q("",!0),4==e.status?(M(),J(u,{key:2,type:"primary",onClick:a=>(async e=>{const a=await j({id:e});1==a.status&&(we.value=a.body.list),he.value=!0})(e.id)},{default:U((()=>[Z])),_:2},1032,["onClick"])):q("",!0),1==e.status?(M(),S("div",$,[e.attach_url?(M(),J(u,{key:0,type:"primary",class:"fcss",onClick:a=>be(e.id)},{default:U((()=>[ee])),_:2},1032,["onClick"])):q("",!0),G(u,{type:"primary",class:"fcss",onClick:a=>(async e=>{await w({id:e}),De()})(e.id)},{default:U((()=>[ae])),_:2},1032,["onClick"]),G(u,{type:"primary",onClick:a=>{return l=e.id,ve.value=!0,void(ye.value=l);var l}},{default:U((()=>[le])),_:2},1032,["onClick"])])):q("",!0)])])),_:1})])),_:1},8,["data"])),[[Ge,s.value]]),G(n,{page:C.value,"onUpdate:page":a[1]||(a[1]=e=>C.value=e),size:o.value,"onUpdate:size":a[2]||(a[2]=e=>o.value=e),total:i.value,onChange:De},null,8,["page","size","total"])])),_:1}),G(p,{modelValue:F.value,"onUpdate:modelValue":a[3]||(a[3]=e=>F.value=e),msg:A.value,title:"驳回原因",btn:1},null,8,["modelValue","msg"]),G(g,{modelValue:he.value,"onUpdate:modelValue":a[5]||(a[5]=e=>he.value=e),title:"详情海报",width:"500px"},{footer:U((()=>[T("span",oe,[G(_,{type:"primary",onClick:a[4]||(a[4]=e=>he.value=!1)},{default:U((()=>[ie])),_:1})])])),default:U((()=>[we.value?(M(),S("div",te,[(M(!0),S(N,null,R(we.value,((e,a)=>(M(),J(h,{key:e,style:{width:"125px",height:"135px","margin-top":"10px"},fit:"",src:e,"preview-src-list":we.value,"initial-index":a},{error:U((()=>[se])),_:2},1032,["src","preview-src-list","initial-index"])))),128))])):q("",!0)])),_:1},8,["modelValue"]),G(g,{modelValue:_e.value,"onUpdate:modelValue":a[6]||(a[6]=e=>_e.value=e),title:"编辑海报",width:"510px","custom-class":"upimgs",onClose:Se},{default:U((()=>[G(I,{model:D(t)},{default:U((()=>[G(O,{label:"海报上传","label-width":"90px"},{default:U((()=>[G(x,{ref_key:"upload",ref:je,action:"#","auto-upload":!1,limit:9,multiple:!0,"list-type":"picture-card","on-change":Oe,"on-preview":Me,"on-remove":Ie,accept:Ve.join(","),class:"upbox"},{default:U((()=>[T("div",re,[G(k,null,{default:U((()=>[G(D(P))])),_:1}),ue])])),_:1},8,["accept"])])),_:1})])),_:1},8,["model"]),de,T("div",ne,[G(_,{onClick:Se},{default:U((()=>[ce])),_:1}),G(_,{type:"primary",disabled:!ge.value.length,onClick:Ue},{default:U((()=>[pe])),_:1},8,["disabled"])])])),_:1},8,["modelValue"]),ke.value?(M(),J(Ce,{key:0,"url-list":we.value,"initial-index":xe.value,onClose:a[7]||(a[7]=e=>ke.value=!1)},null,8,["url-list","initial-index"])):q("",!0),G(v,{modelValue:ve.value,"onUpdate:modelValue":a[8]||(a[8]=e=>ve.value=e),onSuccess:fe},null,8,["modelValue"])])}}})),[["__scopeId","data-v-8a8d9694"]]);export{me as default};

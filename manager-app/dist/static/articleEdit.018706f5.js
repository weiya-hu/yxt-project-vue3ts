var e=Object.defineProperty,l=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,u=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(l,a,t)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[a]=t,d=(e,l)=>{for(var a in l||(l={}))u.call(l,a)&&r(e,a,l[a]);if(t)for(var a of t(l))s.call(l,a)&&r(e,a,l[a]);return e},o=(e,t)=>l(e,a(t));import{q as i,f as n,o as c,t as m,a as p,v,w as f,Q as b,u as _,F as g,a2 as y,Z as h,U as V,aw as j,ax as w,az as P,av as k,b as x,a6 as G,c as O,V as U}from"./vue.89ed3d48.js";import{D as z}from"./DetailsHeader.a6f50e8f.js";import{_ as E}from"./Edit.f721bdef.js";import{t as J,a as q}from"./tp.fd3f5364.js";import{e as F}from"./index.3b31d7d7.js";import{i as I}from"./login.ed01525e.js";import{f as L,g as R,h as S,i as N}from"./resource.afe99190.js";import{m as C}from"./index.f47187aa.js";import{_ as D}from"./index.547c0c45.js";import"./request.356cbcf4.js";const K=e=>(j("data-v-5d3dd647"),e=e(),w(),e),M={class:"article_add"},A={class:"addform"},H={class:"fjend btns"},Q=V(" 返回 "),Z=V(" 保存 "),$=V(" 发布 "),B={class:"form_content"},T={class:"tip fcs"},W=["src"],X=K((()=>v("span",null,"请注意：根据国家相关法律法规要求，切勿发布任何色情、低俗、涉政等违法违规内容。一旦出现，我们将会根据法规进行审核处理。",-1))),Y={class:"upload fcs"},ee={class:"upbox fcc"},le=["src"],ae=["src"],te=K((()=>v("div",{class:"img_tip flex"},"仅支持 JPG、PNG 、JPEG等图片格式，大小不超过2M",-1))),ue={class:"otherURL"},se=K((()=>v("span",null,"第三方URL链接：",-1))),re=K((()=>v("span",null,"第三方URL秘钥：",-1))),de={class:"industry"},oe=K((()=>v("span",null,"行业分类：",-1))),ie={class:"download"},ne=K((()=>v("span",null,"下载设置：",-1))),ce=V("免费下载"),me=V("弹窗二维码");var pe=D(i({setup(e){const l=n("top"),a=C(),t=P(),u=k(),s=t.query.id;s&&L({id:s}).then((e=>{r.value=e.body,e.body.thumb_url&&(w.value="")}));const r=n({id:"",thumb_url:"",title:"",content:"",url:"",url_key:"",digest:"",industry_id:"",down_type:0,qr_code:"",status:1}),i=n();(async()=>{const e=await R();i.value=e.body})();const j=n(),w=n("none"),D={thumb_url:[{validator:(e,l,a)=>{switch(w.value){case"size":a(new Error("请添加大小不超过2M的图片"));break;case"type":a(new Error("请添加 .JPG、.PNG 、.JPEG 格式的图片"));break;case"none":a(new Error("请添加文章封面图片"));break;default:a()}},trigger:"change"}],title:[{required:!0,message:"请输入文章标题（5~30个字）",trigger:"blur"},{min:5,max:30,message:"长度需要在 5 ~ 30 字之间",trigger:"blur"}],digest:[{required:!0,message:"请输入文章摘要（5~100个字）",trigger:"blur"},{min:5,max:100,message:"长度需要在 5 ~ 100 字之间",trigger:"blur"}],content:[{required:!0,message:"请输入文章内容",trigger:"blur"}]},K=n(!1),pe=n(),ve=n(),fe=[".jpg",".png",".jpeg",".JPG",".PNG",".JPEG"],be=n(""),_e=(e,l)=>{be.value=e.name.substring(e.name.lastIndexOf(".")),fe.indexOf(be.value)<0?(w.value="type",j.value.validateField("thumb_url",(()=>null))):e.size&&e.size/1024/1024>2?(w.value="size",j.value.validateField("thumb_url",(()=>null))):(w.value="",ve.value=e.url,j.value.clearValidate("thumb_url"))},ge=e=>{pe.value.clearFiles(),pe.value.handleStart(e[0])},ye=(e,l)=>{ve.value="",Ve()},he=(e,l,a)=>{ve.value="",r.value.thumb_url="",pe.value.clearFiles(),F("封面图片上传失败")};n("");const Ve=async()=>{if(1==r.value.status){1==(await S(o(d({},r.value),{id:s}))).status&&(a.setKeepList([]),u.replace("/cms/resource"))}else{1==(await N(o(d({},r.value),{id:s}))).status&&(a.setKeepList([]),u.replace("/cms/resource"))}K.value=!1},je=n(""),we=n({}),Pe=n(),ke=async e=>{r.value.status=e,j.value.validate((async e=>{if(!e)return!1;K.value=!0,await Pe.value.upImages(),Pe.value.clearImgs(),ve.value?I({site:"official_img"}).then((e=>{1==e.status?(je.value=e.body.host,we.value={key:e.body.dir+"/"+e.body.uuid+be.value,OSSAccessKeyId:e.body.accessid,success_action_status:200,policy:e.body.policy,signature:e.body.signature},r.value.thumb_url=e.body.host+"/"+e.body.dir+"/"+e.body.uuid+be.value,pe.value.submit()):F("上传参数获取失败")})):Ve()}))};return(e,a)=>{const t=x("el-button"),u=x("el-upload"),s=x("el-form-item"),d=x("el-card"),o=x("el-input"),n=x("el-radio"),w=x("el-radio-group"),P=x("el-form"),k=G("loading");return c(),m("div",M,[p(z),v("div",A,[v("div",H,[p(t,{size:"large",onClick:a[0]||(a[0]=l=>e.$router.push("/cms/resource"))},{default:f((()=>[Q])),_:1}),p(t,{size:"large",onClick:a[1]||(a[1]=e=>ke(1))},{default:f((()=>[Z])),_:1}),p(t,{size:"large",type:"primary",onClick:a[2]||(a[2]=e=>ke(2)),disabled:0==r.value.title.length},{default:f((()=>[$])),_:1},8,["disabled"])]),b((c(),m("div",B,[v("div",T,[v("img",{src:_(J),alt:""},null,8,W),X]),p(P,{ref_key:"aFormRef",ref:j,model:r.value,rules:D,size:"large",onSubmit:a[10]||(a[10]=h((()=>{}),["prevent"])),"label-position":l.value},{default:f((()=>[p(d,null,{default:f((()=>[p(s,{label:"上传封面",prop:"thumb_url"},{default:f((()=>[v("div",Y,[p(u,{action:je.value,"auto-upload":!1,limit:1,multiple:!1,"show-file-list":!1,data:we.value,"list-type":"picture","on-change":_e,"on-exceed":ge,"on-success":ye,"on-error":he,accept:".jpg,.png,.jpeg,.JPG,.PNG,.JPEG",ref_key:"upload",ref:pe,class:"flex"},{default:f((()=>[v("div",ee,[ve.value||r.value.thumb_url?(c(),m("img",{key:0,src:ve.value||r.value.thumb_url,class:"title_img",alt:""},null,8,le)):(c(),m("img",{key:1,src:_(q),alt:""},null,8,ae))])])),_:1},8,["action","data"]),te])])),_:1})])),_:1}),p(d,{class:"mt20"},{default:f((()=>[p(s,{label:"摘要",prop:"digest"},{default:f((()=>[p(o,{modelValue:r.value.digest,"onUpdate:modelValue":a[3]||(a[3]=e=>r.value.digest=e),placeholder:"请输入文章摘要（5~100个字）"},null,8,["modelValue"])])),_:1})])),_:1}),p(d,{class:"mt20"},{default:f((()=>[p(s,{label:"文章标题",prop:"title"},{default:f((()=>[p(o,{modelValue:r.value.title,"onUpdate:modelValue":a[4]||(a[4]=e=>r.value.title=e),placeholder:"请输入文章标题（5~30个字）"},null,8,["modelValue"])])),_:1})])),_:1}),p(d,{class:"mt20"},{default:f((()=>[p(s,{label:"文章内容",prop:"content"},{default:f((()=>[p(E,{modelValue:r.value.content,"onUpdate:modelValue":a[5]||(a[5]=e=>r.value.content=e),ref_key:"editRef",ref:Pe},null,8,["modelValue"])])),_:1})])),_:1}),p(d,{class:"mt20"},{default:f((()=>[p(s,{label:"内容设置"},{default:f((()=>[v("div",ue,[se,p(o,{placeholder:"请输入",modelValue:r.value.url,"onUpdate:modelValue":a[6]||(a[6]=e=>r.value.url=e)},null,8,["modelValue"]),re,p(o,{placeholder:"请输入",modelValue:r.value.url_key,"onUpdate:modelValue":a[7]||(a[7]=e=>r.value.url_key=e)},null,8,["modelValue"])]),v("div",de,[oe,p(w,{modelValue:r.value.industry_id,"onUpdate:modelValue":a[8]||(a[8]=e=>r.value.industry_id=e)},{default:f((()=>[(c(!0),m(g,null,y(i.value,(e=>(c(),O(n,{label:e.id,key:e},{default:f((()=>[V(U(e.industry_name),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])]),v("div",ie,[ne,p(w,{modelValue:r.value.down_type,"onUpdate:modelValue":a[9]||(a[9]=e=>r.value.down_type=e)},{default:f((()=>[p(n,{label:1},{default:f((()=>[ce])),_:1}),p(n,{label:2},{default:f((()=>[me])),_:1})])),_:1},8,["modelValue"])])])),_:1})])),_:1})])),_:1},8,["model","label-position"])])),[[k,K.value]])])])}}}),[["__scopeId","data-v-5d3dd647"]]);export{pe as default};

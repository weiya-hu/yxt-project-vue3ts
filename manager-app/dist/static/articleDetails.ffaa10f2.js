var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,u=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t;import{q as o,f as i,o as d,t as c,a as n,v as m,w as p,Q as v,u as f,Z as b,U as g,aw as y,ax as _,az as h,av as j,b as P,a6 as w}from"./vue.89ed3d48.js";import{D as x}from"./DetailsHeader.dc89d7cd.js";import{_ as G}from"./Edit.8fc5be14.js";import{t as O,a as k}from"./tp.fd3f5364.js";import{e as E}from"./index.eaa6bc8d.js";import{i as z}from"./login.6de82fdd.js";import{e as J,j as V}from"./custom.27effc65.js";import{m as I}from"./index.5003068f.js";import{_ as q}from"./index.fdca730b.js";import"./request.aa9790cc.js";const F=e=>(y("data-v-780d7f2b"),e=e(),_(),e),S={class:"article_add"},N={class:"addform"},D={class:"fjend btns"},U=g(" 返回 "),C=g(" 提交 "),K={class:"form_content"},M={class:"tip fcs"},R=["src"],A=F((()=>m("span",null,"请注意：根据国家相关法律法规要求，切勿发布任何色情、低俗、涉政等违法违规内容。一旦出现，我们将会根据法规进行审核处理。",-1))),H={class:"upload fcs"},L={class:"upbox fcc"},Q=["src"],Z=["src"],$=F((()=>m("div",{class:"img_tip flex"},"仅支持 JPG、PNG 、JPEG等图片格式，大小不超过2M",-1)));var B=q(o({setup(e){const o=i("top"),g=I(),y=h(),_=j(),q=y.query.id;q&&J({id:q}).then((e=>{F.value=e.body,e.body.thumb_url&&(T.value="")}));const F=i({thumb_url:"",title:"",content:""}),B=i(),T=i("none"),W={thumb_url:[{validator:(e,a,l)=>{switch(T.value){case"size":l(new Error("请添加大小不超过2M的图片"));break;case"type":l(new Error("请添加 .JPG、.PNG 、.JPEG 格式的图片"));break;case"none":l(new Error("请添加文章封面图片"));break;default:l()}},trigger:"change"}],title:[{required:!0,message:"请输入文章标题（5~30个字）",trigger:"blur"},{min:5,max:30,message:"长度需要在 5 ~ 30 字之间",trigger:"blur"}],content:[{required:!0,message:"请输入文章内容",trigger:"blur"}]},X=i(!1),Y=i(),ee=i(),ae=[".jpg",".png",".jpeg",".JPG",".PNG",".JPEG"],le=i(""),te=(e,a)=>{le.value=e.name.substring(e.name.lastIndexOf(".")),ae.indexOf(le.value)<0?(T.value="type",B.value.validateField("thumb_url",(()=>null))):e.size&&e.size/1024/1024>2?(T.value="size",B.value.validateField("thumb_url",(()=>null))):(T.value="",ee.value=e.url,B.value.clearValidate("thumb_url"))},se=e=>{Y.value.clearFiles(),Y.value.handleStart(e[0])},re=(e,a)=>{ee.value="",oe()},ue=(e,a,l)=>{ee.value="",F.value.thumb_url="",Y.value.clearFiles(),E("封面图片上传失败")},oe=async()=>{const e=await V((o=((e,a)=>{for(var l in a||(a={}))s.call(a,l)&&u(e,l,a[l]);if(t)for(var l of t(a))r.call(a,l)&&u(e,l,a[l]);return e})({},F.value),i={order_id:q},a(o,l(i))));var o,i;1==e.status&&(g.setKeepList([]),_.replace("/cms/custom/article")),X.value=!1},ie=i(""),de=i({}),ce=i(),ne=async e=>{B.value.validate((async e=>{if(!e)return!1;X.value=!0,await ce.value.upImages(),ce.value.clearImgs(),ee.value?z({site:"official_img"}).then((e=>{1==e.status?(ie.value=e.body.host,de.value={key:e.body.dir+"/"+e.body.uuid+le.value,OSSAccessKeyId:e.body.accessid,success_action_status:200,policy:e.body.policy,signature:e.body.signature},F.value.thumb_url=e.body.host+"/"+e.body.dir+"/"+e.body.uuid+le.value,Y.value.submit()):E("上传参数获取失败")})):oe()}))};return(e,a)=>{const l=P("el-button"),t=P("el-upload"),s=P("el-form-item"),r=P("el-card"),u=P("el-input"),i=P("el-form"),g=w("loading");return d(),c("div",S,[n(x),m("div",N,[m("div",D,[n(l,{size:"large",onClick:a[0]||(a[0]=a=>e.$router.push("/cms/custom"))},{default:p((()=>[U])),_:1}),n(l,{size:"large",type:"primary",onClick:ne},{default:p((()=>[C])),_:1})]),v((d(),c("div",K,[m("div",M,[m("img",{src:f(O),alt:""},null,8,R),A]),n(i,{ref_key:"aFormRef",ref:B,model:F.value,rules:W,size:"large",onSubmit:a[3]||(a[3]=b((()=>{}),["prevent"])),"label-position":o.value},{default:p((()=>[n(r,null,{default:p((()=>[n(s,{label:"上传封面",prop:"thumb_url"},{default:p((()=>[m("div",H,[n(t,{action:ie.value,"auto-upload":!1,limit:1,multiple:!1,"show-file-list":!1,data:de.value,"list-type":"picture","on-change":te,"on-exceed":se,"on-success":re,"on-error":ue,accept:".jpg,.png,.jpeg,.JPG,.PNG,.JPEG",ref_key:"upload",ref:Y,class:"flex"},{default:p((()=>[m("div",L,[ee.value||F.value.thumb_url?(d(),c("img",{key:0,src:ee.value||F.value.thumb_url,class:"title_img",alt:""},null,8,Q)):(d(),c("img",{key:1,src:f(k),alt:""},null,8,Z))])])),_:1},8,["action","data"]),$])])),_:1})])),_:1}),n(r,{class:"mt20"},{default:p((()=>[n(s,{label:"文章标题",prop:"title"},{default:p((()=>[n(u,{modelValue:F.value.title,"onUpdate:modelValue":a[1]||(a[1]=e=>F.value.title=e),placeholder:"请输入文章标题（5~30个字）"},null,8,["modelValue"])])),_:1})])),_:1}),n(r,{class:"mt20"},{default:p((()=>[n(s,{label:"文章内容",prop:"content"},{default:p((()=>[n(G,{modelValue:F.value.content,"onUpdate:modelValue":a[2]||(a[2]=e=>F.value.content=e),ref_key:"editRef",ref:ce},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["model","label-position"])])),[[g,X.value]])])])}}}),[["__scopeId","data-v-780d7f2b"]]);export{B as default};

var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,r=(e,a)=>{for(var t in a||(a={}))s.call(a,t)&&i(e,t,a[t]);if(l)for(var t of l(a))o.call(a,t)&&i(e,t,a[t]);return e},u=(e,l)=>a(e,t(l));import{s as d}from"./Search.26ac40a5.js";import{M as n}from"./MyPage.512ed0c7.js";import{M as c}from"./MyDataTable.c0452b38.js";import{M as p}from"./MyDialog.50f39301.js";import{M as m}from"./MyEmpty.72a1acd1.js";import{_ as v}from"./request.aa9790cc.js";import{e as y,o as f}from"./index.eaa6bc8d.js";import{i as b}from"./login.6de82fdd.js";import{a as h,b as g,c as w,e as _,f as j,i as k}from"./custom.27effc65.js";import{_ as x,p as C,a as P,E as O}from"./index.fdca730b.js";import{q as V,f as I,_ as M,o as S,t as E,a as U,w as D,u as G,I as T,Q as q,c as z,F as J,a2 as N,v as F,S as B,U as R,aw as A,ax as K,b as Q,a6 as H}from"./vue.89ed3d48.js";import"./date.23847c74.js";import"./index.5003068f.js";import"./empty.f131d8fb.js";const L=e=>(A("data-v-a955782e"),e=e(),K(),e),W={class:"mytable"},X={class:"fcs"},Y=R("编辑"),Z=R("驳回原因"),$=R("详情"),ee={key:3},ae=R("下载附件"),te=R("通过"),le=R("驳回"),se={key:0,class:"img-dialog"},oe=L((()=>F("div",{class:"image-slot"},[
F("h3",null,"暂无数据")],-1))),ie={class:"dialog-footer"},re=R("确认"),ue=L((()=>F("span",{class:"uptext"},"图片上传：",-1))),de={class:"fc fcc"},ne=L((()=>F("div",{class:"file_name"},"点击上传",-1))),ce=L((()=>F("div",{class:"tips"},"图片尺寸16:9，建议尺寸：220*160≤尺寸≤1920*890；支持JPG、PNG 、JPEG等格式；一次最多上传9张",-1))),pe={class:"fcs btns fjend"},me=R("取消"),ve=R("提交");var ye=x(V(u(r({},{name:"个性化内容库-软文"}),{setup(e,{expose:a}){const t=I([{type:"text",lable:"需求ID",prop:"id",width:120},{type:"text",lable:"账户名",prop:"user_name",width:120},{type:"text",lable:"客户名称",prop:"company_name",width:180},{type:"text",lable:"标题",prop:"title",width:150},{type:"text",lable:"描述",prop:"detail",width:120},{type:"date",lable:"创建日期",prop:"create_time",width:110},{type:"status",lable:"状态",prop:"status",width:100}]),l=I(!1),s=I(10),o=I(0),i=I(1),x=I([]),V=I(!1),R=I(""),A=M({userName:"",status:"",create_time:""}),K=()=>{A.userName="",A.status="",A.create_time="",Ee()},L=e=>{i.value=1,Ee()},ye=async e=>{const a=await w({id:e});1==a.status&&(window.location.href=a.body.attach_url)},fe=I(!1),be=I([]),he=I(!1),ge=I([]),we=I(),_e=I(!1),je=I(0);let ke=[];const xe=I(""),Ce=[".jpg",".png",".jpeg",".JPG",".PNG",".JPEG"],Pe=(e,a)=>{const t=e.name.substring(e.name.lastIndexOf("."));if(-1==Ce.indexOf(t))return we.value.handleRemove(e),void y("图片格式错误！");ge.value=a,ge.value.length>=9&&(document.querySelector(".el-upload--picture-card").style.display="none")},Oe=(e,a)=>{ge.value=a,document.querySelector(".el-upload--picture-card").style.display="inline-flex"},Ve=e=>{let a=[];ge.value.forEach((e=>{a.push(e.url)})),be.value=a,je.value=be.value.findIndex((a=>a==e.url)),_e.value=!0},Ie=()=>{we.value.clearFiles(),he.value=!1,l.value=!1,ge.value=[],be.value=[],_e.value=!1,je.value=0,ke=[]},Me=async(e,a,t)=>{const l=await b({site:"official_img"});if(1==l.status){const a=e.name.substring(e.name.lastIndexOf(".")),t=new FormData,s={key:l.body.dir+"/"+l.body.uuid+a,OSSAccessKeyId:l.body.accessid,success_action_status:200,policy:l.body.policy,signature:l.body.signature};for(const[e,l]of Object.entries(s))t.append(e,l);t.append("file",e.raw);if(200==(await v({url:l.body.host,method:"post",headers:{"Content-Type":"multipart/form-data;"},data:t})).status){const e=l.body.host+"/"+l.body.dir+"/"+l.body.uuid+a;return ke.push(e),Promise.resolve(e)}return Promise.reject(e.name+"上传失败")}return Promise.reject("获取上传配置失败")},Se=async(e,a)=>{l.value=!0;try{for(let e=0;e<ge.value.length;e++){const a=ge.value[e];await Me(a).catch((e=>{throw new Error(e)})).then((()=>{ke.length==ge.value.length&&j({urls:ke,order_id:xe.value}).then((e=>{}))}));if(ke.length==ge.value.length){f("上传成功"),Ie(),Ee();break}}}catch(t){y(t,0),Ie(),Ee()}};a({getData:ye});const Ee=async()=>{l.value=!0;const e=await k(u(r({size:s.value,current:i.value},A),{startTime:A.create_time[0],endTime:A.create_time[1]}));l.value=!1,1==e.status&&(o.value=e.body.total,x.value=e.body.records)};return Ee(),(e,a)=>{const r=Q("el-option"),u=Q("el-link"),v=Q("el-table-column"),y=Q("el-table"),f=Q("el-card"),b=Q("el-image"),w=Q("el-button"),j=Q("el-dialog"),k=Q("el-icon"),I=Q("el-upload"),M=Q("el-image-viewer"),ke=H("loading");return S(),E("div",W,[U(d,{onSearch:L,modelValue:G(A),"onUpdate:modelValue":a[0]||(a[0]=e=>T(A)?A.value=e:A=e),onReset:K},{default:D((()=>[U(r,{label:"待处理",value:"1"}),U(r,{label:"已受理",value:"2"}),U(r,{label:"被驳回",value:"3"}),U(r,{label:"已完成",value:"4"})])),_:1},8,["modelValue"]),U(f,{class:"mycard mt20"},{default:D((()=>[q((S(),z(y,{data:x.value,border:"",style:{width:"100%"},"row-class-name":"my-data-table-row"},{empty:D((()=>[U(m)])),default:D((()=>[(S(!0),E(J,null,N(t.value,((e,a)=>(S(),z(c,{key:a,type:e.type,width:e.width,lable:e.lable,prop:e.prop},null,8,["type","width","lable","prop"])))),128)),U(v,{width:"150",label:"操作"},{default:D((({row:e})=>[F("div",X,[2==e.status?(S(),z(u,{key:0,type:"primary",onClick:a=>{return t=e.id,e.attach_url,xe.value=t,void(he.value=!0);var t}},{default:D((()=>[Y])),_:2},1032,["onClick"])):B("",!0),3==e.status?(S(),z(u,{key:1,type:"primary",onClick:a=>{R.value=e.fail_reason,V.value=!0}},{default:D((()=>[Z])),_:2},1032,["onClick"])):B("",!0),4==e.status?(S(),z(u,{key:2,type:"primary",onClick:a=>(async e=>{const a=await _({id:e});1==a.status&&(be.value=a.body.list),fe.value=!0})(e.id)},{default:D((()=>[$])),_:2},1032,["onClick"])):B("",!0),1==e.status?(S(),E("div",ee,[U(u,{type:"primary",class:"fcss",onClick:a=>ye(e.id)},{default:D((()=>[ae])),_:2},1032,["onClick"]),U(u,{type:"primary",class:"fcss",onClick:a=>(async e=>{await h({id:e}),Ee()})(e.id)},{default:D((()=>[te])),_:2},1032,["onClick"]),U(u,{type:"primary",onClick:a=>{return t=e.id,void P.prompt("驳回原因","提示",{confirmButtonText:"确认",cancelButtonText:"取消"}).then((async({value:e})=>{await g({fail_reason:e,id:t}),Ee()})).catch((()=>{O({type:"info",message:"取消驳回"})}));var t}},{default:D((()=>[le])),_:2},1032,["onClick"])])):B("",!0)])])),_:1})])),_:1},8,["data"])),[[ke,l.value]]),U(n,{total:o.value,page:i.value,"onUpdate:page":a[1]||(a[1]=e=>i.value=e),onChange:Ee,size:s.value,"onUpdate:size":a[2]||(a[2]=e=>s.value=e)},null,8,["total","page","size"])])),_:1}),U(p,{modelValue:V.value,"onUpdate:modelValue":a[3]||(a[3]=e=>V.value=e),msg:R.value,title:"驳回原因",btn:1},null,8,["modelValue","msg"]),U(j,{modelValue:fe.value,"onUpdate:modelValue":a[5]||(a[5]=e=>fe.value=e),title:"详情图片",width:"500px"},{footer:D((()=>[F("span",ie,[U(w,{type:"primary",onClick:a[4]||(a[4]=e=>fe.value=!1)},{default:D((()=>[re])),_:1})])])),default:D((()=>[be.value?(S(),E("div",se,[(S(!0),E(J,null,N(be.value,(e=>(S(),z(b,{style:{width:"125px",height:"135px"},fit:"",key:e,src:e},{error:D((()=>[oe])),_:2},1032,["src"])))),128))])):B("",!0)])),_:1},8,["modelValue"]),U(j,{modelValue:he.value,"onUpdate:modelValue":a[6]||(a[6]=e=>he.value=e),title:"编辑图片",width:"500px",onClose:Ie,"custom-class":"upimgs"},{default:D((()=>[ue,U(I,{action:"#","auto-upload":!1,limit:9,multiple:!0,"list-type":"picture-card","on-change":Pe,"on-preview":Ve,"on-remove":Oe,accept:Ce.join(","),ref_key:"upload",ref:we,class:"upbox"},{default:D((()=>[F("div",de,[U(k,null,{default:D((()=>[U(G(C))])),_:1}),ne])])),_:1},8,["accept"]),ce,F("div",pe,[U(w,{onClick:Ie},{default:D((()=>[me])),_:1}),U(w,{type:"primary",onClick:Se,disabled:!ge.value.length},{default:D((()=>[ve])),_:1},8,["disabled"])])])),_:1},8,["modelValue"]),_e.value?(S(),z(M,{key:0,onClose:a[7]||(a[7]=e=>_e.value=!1),"url-list":be.value,"initial-index":je.value},null,8,["url-list","initial-index"])):B("",!0)])}}})),[["__scopeId","data-v-a955782e"]]);export{ye as default};

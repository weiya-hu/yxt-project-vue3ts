var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,u=(e,a)=>{for(var l in a||(a={}))s.call(a,l)&&i(e,l,a[l]);if(t)for(var l of t(a))o.call(a,l)&&i(e,l,a[l]);return e},r=(e,t)=>a(e,l(t));import{s as d}from"./Search.43a44bd4.js";import{M as n}from"./MyPage.2c8a4bc7.js";import{M as c}from"./MyDataTable.34484506.js";import{M as p}from"./MyDialog.d8f2932e.js";import{M as m}from"./MyEmpty.8e216a46.js";import{_ as v}from"./request.65081ce8.js";import{R as y}from"./Refuse.c4dd5bb9.js";import{e as f,o as b}from"./index.6c11e008.js";import{i as h}from"./login.857dc837.js";import{a as _,b as g,d as w,e as j,i as x}from"./custom.cf7f2d0a.js";import{_ as k,p as C}from"./index.aefc30ce.js";import{G as P,g as O,j as V,o as I,H as M,a as S,w as G,C as U,k as E,_ as z,c as D,P as J,aa as N,I as R,a0 as T,a1 as q,aw as F,ax as A,b as H,ae as K}from"./vue.73bee448.js";import"./date.23847c74.js";import"./index.46ed79dd.js";import"./findb.c1031062.js";import"./empty.f131d8fb.js";import"./tinymce.5416ef76.js";const B=e=>(F("data-v-cc67be78"),e=e(),A(),e),L={class:"mytable"},Q={class:"fcs"},W=q("编辑"),X=q("驳回原因"),Y=q("详情"),Z={key:3},$=q("下载附件"),ee=q("通过"),ae=q("驳回"),le={key:0,class:"img-dialog"},te=B((()=>R("div",{class:"image-slot"},[
R("h3",null,"暂无数据")],-1))),se={class:"dialog-footer"},oe=q("确认"),ie={class:"fc fcc"},ue=B((()=>R("div",{class:"file_name"},"点击上传",-1))),re=B((()=>R("div",{class:"uptext"}," 图片尺寸16:9，建议尺寸：220*160≤尺寸≤1920*890；支持JPG、PNG 、JPEG等格式；一次最多上传9张 ",-1))),de={class:"fcs btns fjend"},ne=q("取消"),ce=q("提交");var pe=k(P(r(u({},{name:"CustomImages"}),{setup(e){const a=O([{type:"text",lable:"需求ID",prop:"id",width:120},{type:"text",lable:"账户名",prop:"user_name",width:120},{type:"text",lable:"客户名称",prop:"company_name",width:180},{type:"text",lable:"标题",prop:"title",width:150},{type:"text-tooltip",lable:"描述",prop:"detail",width:120},{type:"date",lable:"创建日期",prop:"create_time",width:110},{type:"status",lable:"状态",prop:"status",width:100}]),l=V({}),t=O(!1),s=O(10),o=O(0),i=O(1),k=O([]),P=O(!1),q=O(""),F=V({userName:"",status:"",create_time:""}),A=()=>{F.userName="",F.status="",F.create_time="",Se()},B=e=>{i.value=1,Se()},pe=O(!1),me=O(),ve=async e=>{const a={id:me.value,fail_reason:e,status:4},{status:l,body:t}=await g(a);l&&(pe.value=!1,Se())},ye=O(!1),fe=O([]),be=O(!1),he=O([]),_e=O(),ge=O(!1),we=O(0);let je=[];const xe=O(""),ke=[".jpg",".png",".jpeg",".JPG",".PNG",".JPEG"],Ce=(e,a)=>{if(!e.name)return;const l=e.name.substring(e.name.lastIndexOf("."));if(-1==ke.indexOf(l))return _e.value.handleRemove(e),void f("图片格式错误！");he.value=a,he.value.length>=9&&(document.querySelector(".el-upload--picture-card").style.display="none")},Pe=(e,a)=>{he.value=a,document.querySelector(".el-upload--picture-card").style.display="inline-flex"},Oe=e=>{const a=[];he.value.forEach((e=>{a.push(e.url)})),fe.value=a,we.value=fe.value.findIndex((a=>a==e.url)),ge.value=!0},Ve=()=>{_e.value.clearFiles(),be.value=!1,t.value=!1,he.value=[],fe.value=[],ge.value=!1,we.value=0,je=[]},Ie=async(e,a,l)=>{const t=await h({site:"official_img"});if(1==t.status){const a=e.name.substring(e.name.lastIndexOf(".")),l=new FormData,s={key:t.body.dir+"/"+t.body.uuid+a,OSSAccessKeyId:t.body.accessid,success_action_status:200,policy:t.body.policy,signature:t.body.signature};for(const[e,t]of Object.entries(s))l.append(e,t);l.append("file",e.raw);if(200==(await v({url:t.body.host,method:"post",headers:{"Content-Type":"multipart/form-data;"},data:l})).status){const e=t.body.host+"/"+t.body.dir+"/"+t.body.uuid+a;return je.push(e),Promise.resolve(e)}return Promise.reject(e.name+"上传失败")}return Promise.reject("获取上传配置失败")},Me=async(e,a)=>{t.value=!0;try{for(let e=0;e<he.value.length;e++){const a=he.value[e];await Ie(a).catch((e=>{throw new Error(e)})).then((()=>{if(je.length==he.value.length){let e=O({});for(let a=0;a<je.length;a++)e.value=Object.assign(e.value,{[je[a]]:he.value[a].name});j({map:e.value,order_id:xe.value}).then((e=>{b("上传成功"),Ve(),Se()}))}}))}}catch(l){f(l,0),Ve(),Se()}},Se=async()=>{t.value=!0;const e=await x(r(u({size:s.value,current:i.value},F),{startTime:F.create_time?F.create_time[0]:null,endTime:F.create_time?F.create_time[1]:null}));t.value=!1,1==e.status&&(o.value=e.body.total,k.value=e.body.records)};return Se(),(e,u)=>{const r=H("el-option"),v=H("el-link"),f=H("el-table-column"),b=H("el-table"),h=H("el-card"),g=H("el-image"),j=H("el-button"),x=H("el-dialog"),O=H("el-icon"),V=H("el-upload"),je=H("el-form-item"),Ie=H("el-form"),Ge=H("el-image-viewer"),Ue=K("loading");return I(),M("div",L,[S(d,{modelValue:U(F),"onUpdate:modelValue":u[0]||(u[0]=e=>E(F)?F.value=e:F=e),onSearch:B,onReset:A},{default:G((()=>[S(r,{label:"全部",value:"null"}),S(r,{label:"待处理",value:"1"}),S(r,{label:"已受理",value:"2"}),S(r,{label:"被驳回",value:"3"}),S(r,{label:"已完成",value:"4"})])),_:1},8,["modelValue"]),S(h,{class:"mycard mt20"},{default:G((()=>[z((I(),D(b,{data:k.value,border:"",style:{width:"100%"},"row-class-name":"my-data-table-row"},{empty:G((()=>[S(m)])),default:G((()=>[(I(!0),M(J,null,N(a.value,((e,a)=>(I(),D(c,{key:a,type:e.type,width:e.width,lable:e.lable,prop:e.prop},null,8,["type","width","lable","prop"])))),128)),S(f,{width:"150",label:"操作"},{default:G((({row:e})=>[R("div",Q,[2==e.status?(I(),D(v,{key:0,type:"primary",onClick:a=>{return l=e.id,e.attach_url,xe.value=l,void(be.value=!0);var l}},{default:G((()=>[W])),_:2},1032,["onClick"])):T("",!0),3==e.status?(I(),D(v,{key:1,type:"primary",onClick:a=>{q.value=e.fail_reason,P.value=!0}},{default:G((()=>[X])),_:2},1032,["onClick"])):T("",!0),4==e.status?(I(),D(v,{key:2,type:"primary",onClick:a=>(async e=>{const a=await w({id:e});1==a.status&&(fe.value=a.body.list),ye.value=!0})(e.id)},{default:G((()=>[Y])),_:2},1032,["onClick"])):T("",!0),1==e.status?(I(),M("div",Z,[e.attach_url?(I(),D(v,{key:0,type:"primary",class:"fcss",href:e.attach_url,"down-load":"附件.zip"},{default:G((()=>[$])),_:2},1032,["href"])):T("",!0),S(v,{type:"primary",class:"fcss",onClick:a=>(async e=>{const{status:a}=await _({id:e});a&&Se()})(e.id)},{default:G((()=>[ee])),_:2},1032,["onClick"]),S(v,{type:"primary",onClick:a=>{return l=e.id,pe.value=!0,void(me.value=l);var l}},{default:G((()=>[ae])),_:2},1032,["onClick"])])):T("",!0)])])),_:1})])),_:1},8,["data"])),[[Ue,t.value]]),S(n,{page:i.value,"onUpdate:page":u[1]||(u[1]=e=>i.value=e),size:s.value,"onUpdate:size":u[2]||(u[2]=e=>s.value=e),total:o.value,onChange:Se},null,8,["page","size","total"])])),_:1}),S(x,{modelValue:ye.value,"onUpdate:modelValue":u[4]||(u[4]=e=>ye.value=e),title:"详情图片",width:"510px"},{footer:G((()=>[R("span",se,[S(j,{type:"primary",onClick:u[3]||(u[3]=e=>ye.value=!1)},{default:G((()=>[oe])),_:1})])])),default:G((()=>[fe.value?(I(),M("div",le,[(I(!0),M(J,null,N(fe.value,((e,a)=>(I(),D(g,{key:e,style:{width:"120px",height:"135px","margin-top":"10px"},fit:"",src:e,"preview-src-list":fe.value,"initial-index":a},{error:G((()=>[te])),_:2},1032,["src","preview-src-list","initial-index"])))),128))])):T("",!0)])),_:1},8,["modelValue"]),S(x,{modelValue:be.value,"onUpdate:modelValue":u[5]||(u[5]=e=>be.value=e),title:"编辑图片",width:"510px","custom-class":"upimgs",onClose:Ve},{default:G((()=>[S(Ie,{model:U(l)},{default:G((()=>[S(je,{label:"图片上传","label-width":"90px"},{default:G((()=>[S(V,{ref_key:"upload",ref:_e,action:"#","auto-upload":!1,limit:9,multiple:!0,"list-type":"picture-card","on-change":Ce,"on-preview":Oe,"on-remove":Pe,accept:ke.join(","),class:"upbox"},{default:G((()=>[R("div",ie,[S(O,null,{default:G((()=>[S(U(C))])),_:1}),ue])])),_:1},8,["accept"])])),_:1})])),_:1},8,["model"]),re,R("div",de,[S(j,{onClick:Ve},{default:G((()=>[ne])),_:1}),S(j,{type:"primary",disabled:!he.value.length,onClick:Me},{default:G((()=>[ce])),_:1},8,["disabled"])])])),_:1},8,["modelValue"]),ge.value?(I(),D(Ge,{key:0,"url-list":fe.value,"initial-index":we.value,onClose:u[6]||(u[6]=e=>ge.value=!1)},null,8,["url-list","initial-index"])):T("",!0),S(p,{modelValue:P.value,"onUpdate:modelValue":u[7]||(u[7]=e=>P.value=e),msg:q.value,title:"驳回原因",btn:1},null,8,["modelValue","msg"]),S(y,{modelValue:pe.value,"onUpdate:modelValue":u[8]||(u[8]=e=>pe.value=e),onSuccess:ve},null,8,["modelValue"])])}}})),[["__scopeId","data-v-cc67be78"]]);export{pe as default};

import{M as e}from"./MyDataTable.db6ec508.js";import{a,M as l}from"./MyEmpty.2a722683.js";import{_ as t}from"./MyCascader.13381325.js";import{F as r,r as u,a as d,G as o,H as s,X as i,I as n,R as p,u as c,P as m,Q as y,Y as v,a7 as b,U as g,i as f,V as h,av as _,O as w,a6 as V}from"./vue.5acda677.js";import{_ as k,m as x,D as F,E as T,F as q,e as C,G as j}from"./index.e622edbd.js";import{M as U}from"./MyUpload.8c117cd5.js";import{T as M}from"./TopBtns.b126c8e5.js";import"./date.23847c74.js";const E={class:"up2b"},z={class:"mytable"},B={class:"operate-button-pre"},D=["onClick"],I=["onClick"],A=["onClick"],G={key:3},R={class:"flexr"},H=h("取消"),L=h("确认");var O=k(r({setup(r){const h=x();let k=u(0),O=u(1),P=_(),Q=u(!1),S=u(!1),X=u(!1);const Y=u(),J=u(),K=u();let N=u({industryType:[],country:"",name:"",desc:"",updateFile:""}),W=u(),Z=u([]),$=u([{type:"select",prop:"select",width:100},{type:"text",lable:"ID",prop:"id",width:100},{type:"industry_id",lable:"行业分类",prop:"industry_id",width:120},{type:"country",lable:"地区",prop:"country_id",width:100},{type:"text",lable:"采购商品",prop:"product_name",width:150},{type:"text-tooltip",lable:"描述",prop:"demand_desc",width:220},{type:"date",lable:"创建日期",prop:"create_time",width:110},{type:"status_do",lable:"状态",prop:"status",width:100}]);const ee=d({industryType:[{required:!0,message:"请选择行业分类",trigger:"blur"}],country:[{required:!0,message:"请选择地区",trigger:"blur"},{required:!0,message:"请选择地区",trigger:"change"}],name:[{required:!0,message:"请输入采购商品",trigger:"change"},{required:!0,message:"请输入采购商品",trigger:"blur"}],desc:[{required:!0,message:"请输入描述",trigger:"change"},{required:!0,message:"请输入描述",trigger:"blur"}],updateFile:[{validator:(e,a,l)=>{switch(W.value){case"size":l(new Error("请添加大小不超过4M的文件"));break;case"type":l(new Error("请添加 .doc、.docx、.pdf、.xls、.xlsx 格式的文件"));break;case"none":l(new Error("请添加文件"));break;default:l()}},trigger:"change"}]}),ae=async()=>{Q.value=!0;let e={current:O.value,type:2,size:10};const{status:a,body:l}=await F(e);Q.value=!1,a&&(k.value=l.total,Z.value=l.records)};ae();const le=()=>{X.value=!0,K.value=h.state.countryList},te=()=>{Y.value.validate((e=>{if(!e)return!1;S.value=!0,N.value.updateFile?J.value.submit():de()}))},re=e=>{e?(W.value=e,N.value.updateFile="",Y.value.validateField("updateFile",(()=>null))):(W.value="",Y.value.clearValidate("updateFile"))},ue=e=>{N.value.updateFile="",W.value="none",J.value.clear(),S.value=!1,C("上传失败")},de=e=>{j({attachment:e||"",demand_desc:N.value.desc,product_name:N.value.name,type:2,country_id:N.value.country,industry_id:N.value.industryType.join(",")}).then((e=>{e.status?(X.value=!1,Y.value.resetFields(),O.value=1,ae()):(N.value.updateFile="",J.value.clear()),S.value=!1})).catch((()=>{S.value=!1,ue()}))};return(r,u)=>{const d=w("el-table-column"),h=w("el-table"),_=w("el-form-item"),x=w("el-option"),F=w("el-select"),C=w("el-input"),j=w("el-form"),W=w("el-button"),oe=w("el-dialog"),se=V("loading");return o(),s("div",E,[i(M,{onAdd:le}),n("div",z,[p((o(),m(h,{data:c(Z),size:"large","row-class-name":"my-data-table-row"},{empty:y((()=>[i(a)])),default:y((()=>[(o(!0),s(v,null,b(c($),((a,l)=>(o(),m(e,{key:l,type:a.type,width:a.width,lable:a.lable,prop:a.prop},null,8,["type","width","lable","prop"])))),128)),i(d,{fixed:"right",property:"operate",label:"操作","min-width":"100"},{default:y((({row:e})=>[n("div",B,[4===e.status?(o(),s("div",{key:0,class:"operate-button marginr",onClick:a=>(e=>{P.push({path:"/seekAbroad/supplierDetail",query:{id:e.id}})})(e)},"查看",8,D)):g("",!0),2!==e.status?(o(),s("div",{key:1,class:"operate-button marginr",onClick:a=>(e=>{T.confirm("是否确认删除?","操作提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((async()=>{let a={id:e.id};const{status:l}=await q(a);l&&ae()}))})(e)},"删除",8,I)):g("",!0),3===e.status?(o(),s("div",{key:2,class:"operate-button",onClick:a=>(e=>{T.alert(e.fail_reason||"暂没有驳回原因，请联系管理员","驳回原因",{confirmButtonText:"确认"})})(e)},"驳回原因",8,A)):g("",!0),2===e.status?(o(),s("div",G,"---")):g("",!0)])])),_:1})])),_:1},8,["data"])),[[se,c(Q)]])]),n("div",null,[c(k)?(o(),m(l,{key:0,total:c(k),modelValue:c(O),"onUpdate:modelValue":u[0]||(u[0]=e=>f(O)?O.value=e:O=e),onChange:ae},null,8,["total","modelValue"])):g("",!0)]),i(oe,{modelValue:c(X),"onUpdate:modelValue":u[7]||(u[7]=e=>f(X)?X.value=e:X=e),width:500,draggable:"",title:"添加需求","close-on-click-modal":!1},{footer:y((()=>[n("div",R,[i(W,{onClick:u[6]||(u[6]=e=>f(X)?X.value=!1:X=!1)},{default:y((()=>[H])),_:1}),i(W,{type:"primary",onClick:te},{default:y((()=>[L])),_:1})])])),default:y((()=>[n("div",null,[p((o(),m(j,{model:c(N),ref_key:"formRef",ref:Y,rules:c(ee)},{default:y((()=>[i(_,{label:"行业分类",required:"",prop:"industryType"},{default:y((()=>[i(t,{type:"type",modelValue:c(N).industryType,"onUpdate:modelValue":u[1]||(u[1]=e=>c(N).industryType=e)},null,8,["modelValue"])])),_:1}),i(_,{label:"地区",prop:"country"},{default:y((()=>[i(F,{modelValue:c(N).country,"onUpdate:modelValue":u[2]||(u[2]=e=>c(N).country=e),class:"m-2",placeholder:"请选择地区",size:"large",clearable:""},{default:y((()=>[(o(!0),s(v,null,b(K.value,(e=>(o(),m(x,{key:e.code,label:e.country_name,value:e.code},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),i(_,{label:"采购商品",required:"",prop:"name"},{default:y((()=>[i(C,{placeholder:"请输入产品名称",modelValue:c(N).name,"onUpdate:modelValue":u[3]||(u[3]=e=>c(N).name=e),clearable:""},null,8,["modelValue"])])),_:1}),i(_,{label:"描述",required:"",prop:"desc"},{default:y((()=>[i(C,{type:"textarea",maxlength:"150","show-word-limit":"",class:"input-textarea",placeholder:"可简要描述对寻找地区的采购服务商的要求。",modelValue:c(N).desc,"onUpdate:modelValue":u[4]||(u[4]=e=>c(N).desc=e)},null,8,["modelValue"])])),_:1}),i(_,{label:"上传附件",prop:"updateFile"},{default:y((()=>[i(U,{modelValue:c(N).updateFile,"onUpdate:modelValue":u[5]||(u[5]=e=>c(N).updateFile=e),onChange:re,onError:ue,onSuccess:de,ref_key:"upload",ref:J},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])),[[se,c(S)]])])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-3ec406c7"]]);export{O as default};

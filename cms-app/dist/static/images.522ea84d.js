var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,o=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t;import{f as i}from"./date.23847c74.js";import{a as r,g as d,h as n,o as c,f as v,d as m,e as p}from"./index.eda3de22.js";import{M as f}from"./MyEmpty.4bb35154.js";import{_ as y}from"./MyPage.b41c257e.js";import{M as b}from"./MyDialog.6f3f596d.js";import{T as _}from"./TopBtns.bfa79617.js";import{i as h,f as g,g as w,h as k}from"./myWork.5537892c.js";import{d as j,i as C,o as V,t as x,a as O,v as P,w as I,V as M,u as S,L as E,Q as U,c as G,S as D,U as J,av as z,aw as N,b as T,a5 as q}from"./vue.ca737a59.js";const A=e=>(z("data-v-ac7f5874"),e=e(),N(),e),F={class:"m_images"},R={class:"mytable"},B=["src","onClick"],K={class:"els"},L={class:"fcs"},Q={key:0,class:"fcs"},W=J("修改名称"),H=A((()=>P("div",{class:"line"},null,-1))),X=J("删除"),Y=A((()=>P("div",{class:"line"},null,-1))),Z=J("拒绝原因"),$={key:1,class:"fcs"},ee=J("修改名称"),ae=A((()=>P("div",{class:"line"},null,-1))),le=J("删除"),te=A((()=>P("div",{class:"line"},null,-1))),se=J("查看"),ue={class:"fc fcc"},oe=A((()=>P("div",{class:"file_name"},"点击上传",-1))),ie=A((()=>P("div",{class:"tips"},"图片尺寸16:9，建议尺寸：220*160≤尺寸≤1920*890；支持JPG、PNG 、JPEG等格式；一次最多上传9张",-1))),re={class:"fcs btns fjend"},de=J("取消"),ne=J("提交"),ce={class:"flex fjend"},ve=J("确定"),me=j((pe=((e,a)=>{for(var l in a||(a={}))s.call(a,l)&&o(e,l,a[l]);if(t)for(var l of t(a))u.call(a,l)&&o(e,l,a[l]);return e})({},{name:"我的作品库-图片库"}),a(pe,l({setup(e){const a=C(1),l=C(0),t=C([]),s=async()=>{const e=await h({size:10,current:a.value});1==e.status&&(t.value=e.body.records,l.value=e.body.total)};s();const u=()=>{s()},o=C([]),r=e=>{o.value=e},j=C(""),J=C(!1),z=e=>{j.value=e,J.value=!0},N=async()=>{1==(await g({id:j.value})).status&&s(),J.value=!1},A=C([]),me=C(!1),pe=C(0),fe=e=>{let a=[];t.value.forEach((e=>{a.push(e.thumb_url)})),A.value=a,pe.value=A.value.findIndex((a=>a==e)),me.value=!0},ye=C(!1),be=C(""),_e=C(!1),he=C(!1),ge=C([]),we=C();let ke=[];const je=()=>{we.value.clearFiles(),_e.value=!1,he.value=!1,ge.value=[],A.value=[],me.value=!1,pe.value=0,ke=[]},Ce=async e=>{const a=await m({site:"cms_image"});if(1==a.status){const l=e.name.substring(e.name.lastIndexOf(".")),t=e.name.substring(0,e.name.indexOf(".")),s=new FormData,u={key:a.body.dir+"/"+a.body.uuid+l,OSSAccessKeyId:a.body.accessid,success_action_status:200,policy:a.body.policy,signature:a.body.signature};for(const[e,a]of Object.entries(u))s.append(e,a);if(s.append("file",e.raw),200==(await p({url:a.body.host,method:"post",headers:{"Content-Type":"multipart/form-data;"},data:s})).status){const e=a.body.host+"/"+a.body.dir+"/"+a.body.uuid+l;if(ke.push(e),1==(await k({thumb_url:e,source_name:t.slice(0,30)})).status)return Promise.resolve(e)}return Promise.reject(e.name+"上传失败")}return Promise.reject("获取上传配置失败")},Ve=async()=>{he.value=!0;try{for(let e=0;e<ge.value.length;e++){const a=ge.value[e];if(await Ce(a).catch((e=>{throw new Error(e)})),ke.length==ge.value.length){c("上传成功"),je(),s();break}}}catch(e){v(e,0),je(),s()}},xe=[".jpg",".png",".jpeg",".JPG",".PNG",".JPEG"],Oe=(e,a)=>{const l=e.name.substring(e.name.lastIndexOf("."));return-1==xe.indexOf(l)?(we.value.handleRemove(e),void v("图片格式错误！")):e.size&&e.size/1024/1024>10?(we.value.handleRemove(e),void v("图片文件大小不能超过10M")):(ge.value=a,void(ge.value.length>=9&&(document.querySelector(".el-upload--picture-card").style.display="none")))},Pe=(e,a)=>{ge.value=a,document.querySelector(".el-upload--picture-card").style.display="inline-flex"},Ie=e=>{let a=[];ge.value.forEach((e=>{a.push(e.url)})),A.value=a,pe.value=A.value.findIndex((a=>a==e.url)),me.value=!0},Me=C(!1),Se=C(""),Ee=C(""),Ue=(e,a)=>{Se.value=e,Ee.value=a,Me.value=!0},Ge=async()=>{const{status:e}=await w({id:Se.value,source_name:Ee.value});1==e&&(Me.value=!1,s())};return(e,s)=>{const o=T("el-table-column"),c=T("el-link"),v=T("el-table"),m=T("el-icon"),p=T("el-upload"),h=T("el-button"),g=T("el-dialog"),w=T("el-input"),k=T("el-form-item"),j=T("el-form"),C=T("el-image-viewer"),ke=q("loading");return V(),x("div",F,[O(_,{onAdd:s[0]||(s[0]=e=>_e.value=!0)}),P("div",R,[O(v,{data:t.value,style:{width:"100%"},onSelectionChange:r},{empty:I((()=>[O(f)])),default:I((()=>[O(o,{type:"selection",width:"50"}),O(o,{property:"id",label:"ID",width:"230"}),O(o,{property:"thumb_url",label:"图片"},{default:I((({row:e})=>[P("img",{src:e.thumb_url,alt:"",class:"firstimg lookhover",onClick:a=>fe(e.thumb_url)},null,8,B)])),_:1}),O(o,{property:"source_name",label:"图片名",width:"250"},{default:I((({row:e})=>[P("div",K,M(e.source_name),1)])),_:1}),O(o,{property:"create_time",label:"创建日期",width:"200"},{default:I((({row:e})=>[P("div",null,M(S(i)(new Date(e.create_time),"yyyy-MM-dd")),1)])),_:1}),O(o,{property:"status",label:"状态",width:"180"},{default:I((({row:e})=>[P("div",L,[P("div",{class:E(["status_dot",S(d)(e.status).className])},null,2),P("div",null,M(S(d)(e.status).text),1)])])),_:1}),O(o,{label:"操作",fixed:"right",width:"240"},{default:I((({row:e})=>[4==e.status?(V(),x("div",Q,[O(c,{type:"primary",onClick:a=>Ue(e.id,e.source_name)},{default:I((()=>[W])),_:2},1032,["onClick"]),H,O(c,{type:"primary",onClick:a=>z(e.id)},{default:I((()=>[X])),_:2},1032,["onClick"]),Y,O(c,{type:"primary",onClick:a=>{be.value=e.fail_reason,ye.value=!0}},{default:I((()=>[Z])),_:2},1032,["onClick"])])):(V(),x("div",$,[O(c,{type:"primary",onClick:a=>Ue(e.id,e.source_name)},{default:I((()=>[ee])),_:2},1032,["onClick"]),ae,O(c,{type:"primary",onClick:a=>z(e.id)},{default:I((()=>[le])),_:2},1032,["onClick"]),te,O(c,{type:"primary",onClick:a=>fe(e.thumb_url)},{default:I((()=>[se])),_:2},1032,["onClick"])]))])),_:1})])),_:1},8,["data"])]),O(y,{total:l.value,modelValue:a.value,"onUpdate:modelValue":s[1]||(s[1]=e=>a.value=e),onChange:u},null,8,["total","modelValue"]),O(b,{modelValue:J.value,"onUpdate:modelValue":s[2]||(s[2]=e=>J.value=e),msg:"确认删除这条数据吗?",onSure:N},null,8,["modelValue"]),O(b,{modelValue:ye.value,"onUpdate:modelValue":s[3]||(s[3]=e=>ye.value=e),msg:be.value,title:"拒绝原因",btn:1},null,8,["modelValue","msg"]),O(g,{modelValue:_e.value,"onUpdate:modelValue":s[4]||(s[4]=e=>_e.value=e),title:"上传图片",width:"380px",onClose:je,"custom-class":"upimgs"},{default:I((()=>[U((V(),x("div",null,[O(p,{action:"#","auto-upload":!1,limit:9,multiple:!0,"list-type":"picture-card","on-change":Oe,"on-preview":Ie,"on-remove":Pe,accept:xe.join(","),ref_key:"upload",ref:we,class:"upbox"},{default:I((()=>[P("div",ue,[O(m,null,{default:I((()=>[O(S(n))])),_:1}),oe])])),_:1},8,["accept"]),ie,P("div",re,[O(h,{onClick:je},{default:I((()=>[de])),_:1}),O(h,{type:"primary",onClick:Ve,disabled:!ge.value.length},{default:I((()=>[ne])),_:1},8,["disabled"])])])),[[ke,he.value]])])),_:1},8,["modelValue"]),O(g,{modelValue:Me.value,"onUpdate:modelValue":s[6]||(s[6]=e=>Me.value=e),title:"修改名称",width:"380px"},{default:I((()=>[O(j,null,{default:I((()=>[O(k,{label:"输入名称"},{default:I((()=>[O(w,{modelValue:Ee.value,"onUpdate:modelValue":s[5]||(s[5]=e=>Ee.value=e),placeholder:"请输入名称"},null,8,["modelValue"])])),_:1})])),_:1}),P("div",ce,[O(h,{type:"primary",disabled:!Ee.value,onClick:Ge},{default:I((()=>[ve])),_:1},8,["disabled"])])])),_:1},8,["modelValue"]),me.value?(V(),G(C,{key:0,onClose:s[7]||(s[7]=e=>me.value=!1),"url-list":A.value,"initial-index":pe.value},null,8,["url-list","initial-index"])):D("",!0)])}}}))));var pe,fe=r(me,[["__scopeId","data-v-ac7f5874"]]);export{fe as default};
